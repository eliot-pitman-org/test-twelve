/*
The code in this file generates <script> elements for required dependencies to be added in the document head.
This is done here rather than directly ion index.ejs for readability, and to allow for a strong Content Security Policy
using 'strict-dynamic' without requiring new hashes for minor changes.
 */

// Adds import map (from k8s deployment config or generated by build-import-map.sh for local) to the document.
const importMapScript = document.createElement('script');
importMapScript.src = '/import-map.json';
importMapScript.type = 'systemjs-importmap';
importMapScript.async = false;
document.head.appendChild(importMapScript);

// Preloads basic Single-Spa dependency
const singleSpaScript = document.createElement('link');
singleSpaScript.rel = 'preload';
singleSpaScript.href = 'https://cdn.jsdelivr.net/npm/single-spa@5.9.0/lib/system/single-spa.min.js';
singleSpaScript.as = 'script';
document.head.appendChild(singleSpaScript);

// Array of script sources that will be added to the document, starting with the Root UI's env-config.js file.
const scripts = [ 'env-config.js' ];
scripts.push('https://cdn.jsdelivr.net/npm/regenerator-runtime@0.13.7/runtime.min.js');

/*
If you need to support Angular applications, uncomment the line below to ensure only one instance of ZoneJS is loaded
Learn more about why at https://single-spa.js.org/docs/ecosystem-angular/#zonejs
*/
// scripts.push('https://cdn.jsdelivr.net/npm/zone.js@0.11.3/dist/zone.min.js');

// Lastly adds scripts for other dependencies, using full for local & dev environments and minified versions beyond.
if (window.origin.includes('localhost:') || window.origin.endsWith('.dev.bip.va.gov')) {
  scripts.push(
    'https://cdn.jsdelivr.net/npm/import-map-overrides@2.2.0/dist/import-map-overrides.js',
    'https://cdn.jsdelivr.net/npm/systemjs@6.8.3/dist/system.js',
    'https://cdn.jsdelivr.net/npm/systemjs@6.8.3/dist/extras/amd.js'
  );
} else {
  scripts.push(
    'https://cdn.jsdelivr.net/npm/import-map-overrides@2.2.0/dist/import-map-overrides.min.js',
    'https://cdn.jsdelivr.net/npm/systemjs@6.8.3/dist/system.min.js',
    'https://cdn.jsdelivr.net/npm/systemjs@6.8.3/dist/extras/amd.min.js'
  );
}
scripts.forEach((scriptUrl) => {
  const scriptElement = document.createElement('script');
  scriptElement.src = scriptUrl;
  scriptElement.async = false;
  document.head.appendChild(scriptElement);
});